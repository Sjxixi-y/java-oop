# 网络编程

网络：资源共享、数据交换



## 通信协议



### 分层

#### TCP/IP 模型：

世界范围内的实际模型，分为4层

- 应用层
- 传输层
- 网络层
- 数据链路层和物理层



#### ISO 模型

理论上的模型：7层



### 数据的封装与拆封：

#### 封装：

数据由应用层逐层包装，直到物理层。原本数据之外包含了其他校验信息、目标地址等等。



#### 拆封

数据包由物理层逐层拆封，直到应用层。



### 各层协议

![](E:\thinkaboutai\java-oop\src\com\itsjxixi\internet\img\1.jpg)



### InetAddress IP地址对象

包含了与该IP地址相关的所有信息。没有提供构造方法，但提供了静态方法 。（工厂模式）



#### 方法：

getLocalHost

```java
// 创建本机对象
InetAddress ip1 = InetAddress.getLocalHost();
```



getByName

```java
// 创建目标对象
InetAddress ip2 = InetAddress.getByName("www.baidu.com");
```



getHostAddress

```java
// 获取 IP 地址的字符串形式
ip1.getHostAddress()
```



getHostName

```java
// 获取计算机名称
ip1.getHostName()
```



### InetSocketAddress 包含端口的IP地址对象

#### 方法：

##### getHostName

```java
// 获取 IP
isa.getHostName()
```



##### getPort

```
// 获取 端口
System.out.println(isa.getPort());
```



##### getAddress

```java
// 获取 IntAddress 对象
InetAddress ia = isa.getAddress();
```



### URL

统一资源定位符，包括：协议、域名、端口、资源文件名 四个部分。

#### 创建：

```java
URL url = new URL("http://www.baidu.com:80/index.html#aa?cansu=bjsxt");
```



#### 方法：

##### getDefaultPort

```java
// 获取 端口
url.getDefaultPort()
```



##### getFile

```java
// 获取 域名
url.getHost()
```



##### getPath

```java
// 获取 文件名
url.getPath()
```



##### getPort

```java
// 获取 端口
url.getPort()
```



##### getProtocol

```java
// 获取 协议
System.out.println(url.getProtocol());
```



##### getQuery

```java
// 获取
System.out.println(url.getQuery());
```



##### getRef

```java
// 获取 参数
System.out.println(url.getRef());
```



### 套接字 Socket

位于应用层与传输层之间的一道桥梁。而，程序员在应用层出的程序产生的数据，只需要交给 套接字 处理即可。



## TCP编程

### 概念：

> 一种面向连接（连接导向）的、可靠的、基于字节流的运输层（Transport layer）通信协议 。



### 特点 

* 面向连接 
* 点到点的通信 
* 高可靠性 
* 占用系统资源多、效率低 



### 服务端：

1. 创建一个ServerSocket，指定等待端口
2. 使用ServerSocket接收用户的请求（处于监听状态）
3. 创建输入流来接收用户的数据
4. 接收用户数据并输出
5. 关闭流和socket



### 客户端：

1. 创建Socket，用来发送请求
2. 创建输出流
3. 发送数据
4. 关闭流和socket



### 案例：

**案例：**客户端传入字符串，服务端控制台输出

Client

```java
public class Client {
    public static void main(String[] args) throws IOException {
        // 创建
        Socket socket = new Socket(InetAddress.getByName("127.0.0.1"), 25550);

        // 创建输出流
        OutputStream os = socket.getOutputStream();
        DataOutputStream dos = new DataOutputStream(os);

        // 发送数据
        String str = "你好，未来的我。";
        dos.writeUTF(str);

        // 关流
        dos.close();
        socket.close();
    }
}
```



Server

```java
public class Server {
    public static void main(String[] args) throws IOException {
        // 创建
        ServerSocket socket = new ServerSocket(25550);

        // 接收
        Socket s1 = socket.accept();

        // 创建输入流
        InputStream is = s1.getInputStream();
        DataInputStream dis = new DataInputStream(is);

        // 接收客户端输出
        System.out.println(dis.readUTF());

        // 关闭流
        dis.close();
        s1.close();
        socket.close();
    }
}
```



**案例：**客户端传入字符串，服务端控制台输出，随后服务端传入，客户端输出

demo2



**案例：**对象传输-用户登录

demo3



**案例：**多线程，用户登录

demo4



## UDP

### 概念：

> 一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。



### 特点:

* 非面向连接，传输不可靠，可能丢失。 
* 发送不管对方是否准备好，接收方收到也不确认。
* 可以广播发送。
* 非常简单的协议，开销小。



### 服务端：

1. 创建socket，用来发送和接收数据包
2. 创建数据包，用来接收客户端发送的数据和ip，端口
3. 使用socket和数据包来接收客户端的信息
4. 输出客户端发来的信息
5. 关闭socket



### 客户端：

1. 创建Socket，用来发送和接收数据
2. 创建数据包，用来存放要发送的数据和ip，端口等信息
3. 使用Socket发送数据包
4. 关闭socket



### 案例：

**案例：**单次单向

Server

```
public class Server {
    public static void main(String[] args) throws IOException {
        // 创建 socket
        DatagramSocket socket = new DatagramSocket(25566);

        // 创建数据包，

        byte[] b = new byte[1024];

        DatagramPacket packet = new DatagramPacket(b, b.length);

        // 接收数据
        socket.receive(packet);
        // 输出
        System.out.println("数据："+new String(packet.getData(),0,packet.getLength()));
        System.out.println("IP:"+packet.getAddress());//另外一端的IP
        System.out.println("端口："+packet.getPort());//另外一端的端口

        // 关闭
        socket.close();
    }
}
```



Client

```
public class Client {
    public static void main(String[] args) throws IOException {
        // 创建 Socket
        DatagramSocket socket = new DatagramSocket();
        // 创建数据报包
        String str = "akgenoiqgue";
        byte[] b = str.getBytes();

        DatagramPacket packet = new DatagramPacket(b, b.length,			 InetAddress.getByName("127.0.0.1"), 25566);
        // 发送数据报包
        socket.send(packet);
        // 关闭资源
        socket.close();
    }
}
```



**案例：**单次双向

demo2



**案例：**多次双向

demo3



**案例：**传输对象









































