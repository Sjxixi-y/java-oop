# 反射

## 类的加载



### 一、加载

读取 class文件 创建一个 class 对象。

注意：每个类在被使用是系统都会创建一个class对象。



### 二、连接

验证：是否有正确的内部结构，并和其他类协调一致。

准备：负责为类的静态成员分配内存，并设置默认初始化值。 

解析：将类的二进制数据中的符号引用替换为直接引用。



### 三、初始化

就是我们以前讲过的初始化步骤。 



## 类加载器的组成：

### 根类加载器：

负责核心类的加载。



### 拓展类加载器：

JRE 中的 jar 包



### 系统类加载器

负责在JVM启动时加载来自java命令的class文件，以及classpath环境变量所指定的jar包和类路径。 



## 反射

> 动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。



**前提：**获取一个类的 class 对象（字节码对象）

**作用：**在不直接创建类的对象的情况下，使用类的属性和方法。



### 获取 class 对象方式：

1.对象.class 方法

2.类.class 方法

3.Class.forName("全路径") 方法 -- （晚于连接阶段）

```java
Class clazz = Class.forName("全类名");
```

**示例：**demo1



### 获取构造方法

**对象：Constructor**



#### 方法：

##### 获取全部公有的

```java
Constructor[] c1 = clazz.getConstructors();
```



##### 获取指定的公有的（参数列表区分）

```java
Constructor c2 = clazz.getConstructor(String.class);
```



##### 获取所有（包括私有的）

```java
Constructor[] c3 = clazz.getDeclaredConstructors();
```



##### 获取单个私有 （参数列表区分）

```java
Constructor c4 = clazz.getDeclaredConstructor(int.class);
```



##### 通过获取的构造方法创建对象

```java
Object o = c5.newInstance();
```



##### 对于私有的构造方法需要先设置 允许暴力访问。

```java
c4.setAccessible(true);
```



### 获取成员属性

**对象：Field**



#### 方法：

##### 获取全部公有的属性

```java
Field[] f1 = aClass.getFields();
```



##### 获取指定的公有的属性（指定属性名）

```java
Field f2 = aClass.getField("b");
```



##### 获取指定的私有的属性

```java
Field f3 = aClass.getDeclaredField("a");
```



##### 获取全部属性（包括私有的）

```java
Field[] f4 = aClass.getDeclaredFields();
```



##### 获取属性值

```java
int o1 = (int) f2.get(o);
System.out.println(o1);
```



##### 暴力访问

```java
f3.setAccessible(true);
int o2 = (int) f3.get(o);
System.out.println(o2);
```



### 获取方法

**对象：Method**



#### 方法：

##### 获取所方法,包括来自父类的方法，但不能获取私有的。 

```java
Method[] m1 = aClass.getMethods();
```



##### 获取所有的方法，包括私有的方法

```java
Method[] m2 = aClass.getDeclaredMethods();
```



##### 获取单个非公共方法

```java
Method m3 = aClass.getMethod("B", int.class);
```



##### 获取单个方法，包括非公有

```java
Method m4 = aClass.getDeclaredMethod("D", int.class);
```



##### 使用方法，返回方法的返回值。

```java
Object o1 = m3.invoke(o, 1);
System.out.println(o1);
```



##### 强制

```java
m4.setAccessible(true);
m4.invoke(o, 1);
```



















